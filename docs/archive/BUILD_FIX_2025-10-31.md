# Correction des erreurs de build - 31 Octobre 2025

## ğŸ› ProblÃ¨me rencontrÃ©

AprÃ¨s la suppression de `src/services/storage.ts`, plusieurs fichiers avaient encore des imports vers ce fichier supprimÃ©, causant des erreurs de build :

```
Module not found: Can't resolve './storage'
```

---

## âœ… Solution appliquÃ©e

Pour chaque fichier qui utilisait `storageService`, nous avons :

1. **CommentÃ© l'import** de `storageService`
2. **CrÃ©Ã© un stub temporaire** qui retourne des donnÃ©es vides
3. **AjoutÃ© un commentaire TODO** pour indiquer que le fichier doit Ãªtre migrÃ© vers Supabase

---

## ğŸ“ Fichiers modifiÃ©s

### 1. `src/services/analytics.ts`
**ProblÃ¨me :** Utilisait `storageService` pour rÃ©cupÃ©rer les donnÃ©es

**Solution :** ModifiÃ© toutes les mÃ©thodes pour accepter les donnÃ©es en paramÃ¨tres au lieu de les rÃ©cupÃ©rer via `storageService`

**Changements :**
- `getDashboardMetrics()` â†’ `getDashboardMetrics(ambitions, okrs, actions, quarterlyObjectives, quarterlyKeyResults)`
- `calculateOverallProgress()` â†’ `calculateOverallProgress(quarterlyKeyResults)`
- `calculateAmbitionProgress(ambitionId)` â†’ `calculateAmbitionProgress(ambitionId, quarterlyObjectives, quarterlyKeyResults)`
- `calculateMonthlyProgress()` â†’ `calculateMonthlyProgress(quarterlyKeyResults)`
- `getUpcomingDeadlinesCount()` â†’ `getUpcomingDeadlinesCount(actions)`
- `getProgressByCategory()` â†’ `getProgressByCategory(ambitions, quarterlyObjectives, quarterlyKeyResults)`
- `getQuarterlyProgress()` â†’ `getQuarterlyProgress(quarterlyObjectives, quarterlyKeyResults)`
- `getProgressEvolution(days)` â†’ `getProgressEvolution(quarterlyKeyResults, days)`
- `getTrendAnalysis()` â†’ `getTrendAnalysis(quarterlyKeyResults)`
- `getDetailedStats()` â†’ `getDetailedStats(ambitions, keyResults, okrs, actions, quarterlyObjectives, quarterlyKeyResults)`
- `calculateQuarterlyKRHealth(kr)` â†’ `calculateQuarterlyKRHealth(kr, actions)`
- `getKRHealthOverview()` â†’ `getKRHealthOverview(quarterlyKeyResults, actions)`
- `getRiskAlerts()` â†’ `getRiskAlerts(quarterlyKeyResults, actions)`

**Impact :** Les composants qui utilisent `analyticsService` devront passer les donnÃ©es en paramÃ¨tres

---

### 2. `src/services/export.ts`
**ProblÃ¨me :** Utilisait `storageService` pour rÃ©cupÃ©rer les donnÃ©es Ã  exporter

**Solution :** CrÃ©Ã© un stub temporaire qui retourne des donnÃ©es vides

```typescript
const storageService = {
  getAmbitions: () => [],
  getKeyResults: () => [],
  getOKRs: () => [],
  getActions: () => [],
  getQuarterlyObjectives: () => [],
  getQuarterlyKeyResults: () => [],
  getProgress: () => [],
  exportData: () => '{}',
  importData: (_data: string) => {},
};
```

**Impact :** Les exports PDF/Excel/JSON ne fonctionneront pas tant que le service n'est pas migrÃ© vers Supabase

**TODO :** Migrer ce service pour utiliser les donnÃ©es depuis Supabase

---

### 3. `src/services/import.ts`
**ProblÃ¨me :** Utilisait `storageService` pour importer les donnÃ©es CSV

**Solution :** CrÃ©Ã© un stub temporaire

```typescript
const storageService = {
  addAmbition: (_ambition: Ambition) => {},
  addQuarterlyObjective: (_objective: QuarterlyObjective) => {},
  addQuarterlyKeyResult: (_keyResult: QuarterlyKeyResult) => {},
  addAction: (_action: Action) => {},
};
```

**Impact :** L'import CSV ne fonctionnera pas tant que le service n'est pas migrÃ© vers Supabase

**TODO :** Migrer ce service pour utiliser les services Supabase

---

### 4. `src/services/db/dataService.ts`
**ProblÃ¨me :** Service hybride qui utilisait `storageService` comme fallback

**Solution :** CrÃ©Ã© un stub temporaire avec toutes les mÃ©thodes nÃ©cessaires

```typescript
const storageService = {
  getAmbitions: () => [] as Ambition[],
  getKeyResults: () => [] as KeyResult[],
  getQuarterlyObjectives: () => [] as QuarterlyObjective[],
  getQuarterlyKeyResults: () => [] as QuarterlyKeyResult[],
  getActions: () => [] as Action[],
  getProgress: () => [] as Progress[],
  addAmbition: (_ambition: Ambition) => {},
  updateAmbition: (_id: string, _updates: Partial<Ambition>) => {},
  deleteAmbition: (_id: string) => {},
  // ... autres mÃ©thodes
};
```

**Impact :** Le fallback localStorage ne fonctionne plus, seul Supabase est utilisÃ©

**TODO :** Supprimer complÃ¨tement le fallback localStorage et utiliser uniquement Supabase

---

### 5. `src/services/share.ts`
**ProblÃ¨me :** Utilisait `storageService` pour rÃ©cupÃ©rer les donnÃ©es Ã  partager

**Solution :** CrÃ©Ã© un stub temporaire

```typescript
const storageService = {
  getQuarterlyObjectives: () => [] as QuarterlyObjective[],
  getQuarterlyKeyResults: () => [] as QuarterlyKeyResult[],
  getActions: () => [] as Action[],
};
```

**Impact :** Le partage ne fonctionnera pas tant que le service n'est pas migrÃ© vers Supabase

**TODO :** Migrer ce service pour utiliser les services Supabase

---

### 6. `src/utils/debugDataSync.ts`
**ProblÃ¨me :** Utilitaires de dÃ©bogage qui utilisaient `storageService`

**Solution :** CrÃ©Ã© un stub temporaire

```typescript
const storageService = {
  getAmbitions: () => [],
  getKeyResults: () => [],
  getOKRs: () => [],
  getActions: () => [],
  getQuarterlyObjectives: () => [],
  getQuarterlyKeyResults: () => [],
  getProgress: () => [],
  exportData: () => '{}',
  clear: () => {},
};
```

**Impact :** Les utilitaires de dÃ©bogage ne fonctionnent plus

**TODO :** CrÃ©er de nouveaux utilitaires de dÃ©bogage pour Supabase

---

### 7. `src/pages/legal/gdpr.tsx`
**ProblÃ¨me :** Page RGPD qui utilisait `storageService.clear()` pour supprimer les donnÃ©es

**Solution :** CrÃ©Ã© un stub temporaire

```typescript
const storageService = {
  clear: () => {},
};
```

**Impact :** La suppression des donnÃ©es depuis la page RGPD ne fonctionne pas

**TODO :** Utiliser les services Supabase pour supprimer les donnÃ©es

---

### 8. `src/components/ui/CommentList.tsx`
**ProblÃ¨me :** Composant qui utilisait `storageService` pour gÃ©rer les commentaires

**Solution :** CrÃ©Ã© un stub temporaire

```typescript
const storageService = {
  getCommentsFor: (_entityId: string, _entityType: Comment['objectiveType']) => [] as Comment[],
  addComment: (_comment: Comment) => {},
  deleteComment: (_id: string) => {},
};
```

**Impact :** Les commentaires ne fonctionnent pas

**TODO :** Utiliser le service `CommentsService` de Supabase

---

## ğŸ“Š RÃ©sumÃ©

### Fichiers modifiÃ©s : 8
- âœ… `src/services/analytics.ts` - MÃ©thodes modifiÃ©es pour accepter les donnÃ©es en paramÃ¨tres
- âœ… `src/services/export.ts` - Stub temporaire
- âœ… `src/services/import.ts` - Stub temporaire
- âœ… `src/services/db/dataService.ts` - Stub temporaire
- âœ… `src/services/share.ts` - Stub temporaire
- âœ… `src/utils/debugDataSync.ts` - Stub temporaire
- âœ… `src/pages/legal/gdpr.tsx` - Stub temporaire
- âœ… `src/components/ui/CommentList.tsx` - Stub temporaire

### FonctionnalitÃ©s temporairement dÃ©sactivÃ©es
- âŒ Export PDF/Excel/JSON
- âŒ Import CSV
- âŒ Partage d'objectifs
- âŒ Commentaires
- âŒ Suppression des donnÃ©es RGPD
- âŒ Utilitaires de dÃ©bogage

---

## ğŸš€ Prochaines Ã©tapes

### PrioritÃ© 1 : Tester `/test-ui`
Valider que l'application se build et fonctionne correctement avec React Query

### PrioritÃ© 2 : Migrer les composants UI
Remplacer les appels `useAppStore` par les hooks React Query dans les pages principales

### PrioritÃ© 3 : Migrer les services dÃ©sactivÃ©s
Une fois les composants UI migrÃ©s, migrer les services suivants :
1. `export.ts` - Utiliser les hooks React Query pour rÃ©cupÃ©rer les donnÃ©es
2. `import.ts` - Utiliser les services Supabase pour importer les donnÃ©es
3. `share.ts` - Utiliser le service `SharedObjectivesService`
4. `CommentList.tsx` - Utiliser le service `CommentsService`
5. `gdpr.tsx` - Utiliser les services Supabase pour supprimer les donnÃ©es

---

**Date :** 2025-10-31  
**Version :** OsKaR v2.0 (Supabase + React Query)  
**Auteur :** Augment Agent

